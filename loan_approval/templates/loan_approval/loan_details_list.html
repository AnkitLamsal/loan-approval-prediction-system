{% if user.is_authenticated %}
{% if not request.user.is_superuser %}
<style>
    table,td, tr{
        border:2px black solid;
    }
</style>    
<h3>Check Approved Loans {{request.user}}</h3>
<table>
<tr>
    {% if request.user.applicant %}
    <td>Requested Applicants Name</td>
    <td> Loan Manager </td>
    <td>Applicant Employment Length</td>
    <td>Intention of Loan</td>
    <td>Amount Applied</td>
    <td> Prediction Approval </td>
    <td>Loan Details</td>
    {% endif %}
    {% if request.user.employee %}
    <td>Requested Applicants Name</td>
    <td>Applicant Employment Length</td>
    <td>Intention of Loan</td>
    <td>Amount Applied</td>
    <td>Credit History</td>
    <td>Credit Default</td>
    <td>Loan Interest Rate</td>
    <td> Prediction Approval </td>
    <td>Loan Details</td>
    {% endif %}
</tr>
{% for object in object_list %}
<tr>
    {% if request.user.applicant %}
    <td>{{ object.loan_request.applicant_details }}</td>
    <td> {{ object.loan_request.managed_by }} </td>
    <td>{{ object.loan_request.emp_length }}</td>
    <td>{{ object.loan_request.loan_intent }}</td>
    <td>{{ object.loan_request.loan_amount }}</td>
    {% comment %} <td><a href="{% url 'loan_approval:predict' pk=object.loan_request.id%}">Details</a></td> {% endcomment %}
    <td>
        <input type="button" class="predict-button-{{object.loan_request.id}}" value="Predict"
                        onclick="submit({id: {{object.loan_request.id}}})" />
        <h3 class="hello-{{object.loan_request.id}}"></h3>
    </td>
    <td><a href="{% url 'loan_approval:loan_details_detail' pk=object.id%}">Details</a></td>
    {% endif %}
    {% if request.user.employee %}
    <td>{{ object.loan_request.applicant_details }}</td>
    <td>{{ object.loan_request.emp_length }}</td>
    <td>{{ object.loan_request.loan_intent }}</td>
    <td>{{ object.loan_request.loan_amount }}</td>
    <td>{{ object.credit_history }}</td>
    <td>{{ object.credit_default }}</td>
    <td>{{ object.interest_rate }}</td>
    <td> <input type="button" class="predict-button-{{object.loan_request.id}}" value="Predict"
        onclick="submit({id: {{object.loan_request.id}}})" />
<h3 class="hello-{{object.loan_request.id}}"></h3></td>
    <td><a href="{% url 'loan_approval:loan_details_detail' pk=object.id%}">Details</a></td>
    {% endif %}
</tr>
{% endfor %}
{% else %}
403 Error: Not authorized
{% endif %}
{% else %}
404 Error 
{% endif %}

<script>
    function submit({
        id
    }) {
        fetch(`/loan/predict/${id}/`)
            .then(response => response.json())
            .then(data => manipulate(data,id))
    };
    function manipulate(data,id){
        console.log(data);
        //console.log(id);
        prediction_button = document.querySelector(`.predict-button-${id}`);
        //console.log(`predict-button-${id}`);
        //console.log(prediction_button);
        prediction = document.querySelector(`.hello-${id}`);
        //console.log(prediction)
        console.log(data['prediction']);
        prediction_button.style.display = "none";
        if(data['prediction']==false){
            prediction.innerText = "Rejected.";    
        }
        else{
            prediction.innerText = "Approved.";
        }
        //
        //document.querySelector('.beruju_hide').style.display = "block";
    }
</script>
